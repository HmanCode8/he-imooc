/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.114
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */

import{a as y}from"./chunk-PREP6EDJ.js";import{d as j}from"./chunk-JJFA6IXC.js";import{b as d,c as L}from"./chunk-CJEZWAOI.js";import{a as D}from"./chunk-PF7ABWYW.js";import{a as s,c as x,d as M}from"./chunk-KXWBEOUA.js";import{a as b}from"./chunk-4BEFMW7D.js";import{a as E}from"./chunk-2F4MHS2T.js";import{a as R,b as P}from"./chunk-3Z2AZRQC.js";import{e as l}from"./chunk-A5XXOFX2.js";function N(o,t){P.typeOf.object("ellipsoid",o),this._ellipsoid=o,this._cameraPosition=new s,this._cameraPositionInScaledSpace=new s,this._distanceToLimbInScaledSpaceSquared=0,l(t)&&(this.cameraPosition=t)}Object.defineProperties(N.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(o){let e=this._ellipsoid.transformPositionToScaledSpace(o,this._cameraPositionInScaledSpace),n=s.magnitudeSquared(e)-1;s.clone(o,this._cameraPosition),this._cameraPositionInScaledSpace=e,this._distanceToLimbInScaledSpaceSquared=n}}});var U=new s;N.prototype.isPointVisible=function(o,t){if(l(t)&&t===!0)return!0;let n=this._ellipsoid.transformPositionToScaledSpace(o,U);return k(n,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};N.prototype.isScaledSpacePointVisible=function(o){return k(o,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};var nt=new s;N.prototype.isScaledSpacePointVisiblePossiblyUnderEllipsoid=function(o,t){let e=this._ellipsoid,n,i;return l(t)&&t<0&&e.minimumRadius>-t?(i=nt,i.x=this._cameraPosition.x/(e.radii.x+t),i.y=this._cameraPosition.y/(e.radii.y+t),i.z=this._cameraPosition.z/(e.radii.z+t),n=i.x*i.x+i.y*i.y+i.z*i.z-1):(i=this._cameraPositionInScaledSpace,n=this._distanceToLimbInScaledSpaceSquared),k(o,i,n)};N.prototype.computeHorizonCullingPoint=function(o,t,e){return Q(this._ellipsoid,o,t,e)};var v=M.clone(M.UNIT_SPHERE);N.prototype.computeHorizonCullingPointPossiblyUnderEllipsoid=function(o,t,e,n){let i=Z(this._ellipsoid,e,v);return Q(i,o,t,n)};N.prototype.computeHorizonCullingPointFromVertices=function(o,t,e,n,i){return J(this._ellipsoid,o,t,e,n,i)};N.prototype.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid=function(o,t,e,n,i,c){let a=Z(this._ellipsoid,i,v);return J(a,o,t,e,n,c)};var at=[];N.prototype.computeHorizonCullingPointFromRectangle=function(o,t,e){P.typeOf.object("rectangle",o);let n=L.subsample(o,t,0,at),i=j.fromPoints(n);if(!(s.magnitude(i.center)<.1*t.minimumRadius))return this.computeHorizonCullingPoint(i.center,n,e)};var st=new s;function Z(o,t,e){if(l(t)&&t<0&&o.minimumRadius>-t){let n=s.fromElements(o.radii.x+t,o.radii.y+t,o.radii.z+t,st);o=M.fromCartesian3(n,e)}return o}function Q(o,t,e,n){P.typeOf.object("directionToPoint",t),P.defined("positions",e),l(n)||(n=new s);let i=Y(o,t),c=0;for(let a=0,r=e.length;a<r;++a){let m=e[a],h=K(o,m,i);if(h<0)return;c=Math.max(c,h)}return X(i,c,n)}var O=new s;function J(o,t,e,n,i,c){P.typeOf.object("directionToPoint",t),P.defined("vertices",e),P.typeOf.number("stride",n),l(c)||(c=new s),n=E(n,3),i=E(i,s.ZERO);let a=Y(o,t),r=0;for(let m=0,h=e.length;m<h;m+=n){O.x=e[m]+i.x,O.y=e[m+1]+i.y,O.z=e[m+2]+i.z;let u=K(o,O,a);if(u<0)return;r=Math.max(r,u)}return X(a,r,c)}function k(o,t,e){let n=t,i=e,c=s.subtract(o,n,U),a=-s.dot(c,n);return!(i<0?a>0:a>i&&a*a/s.magnitudeSquared(c)>i)}var ct=new s,rt=new s;function K(o,t,e){let n=o.transformPositionToScaledSpace(t,ct),i=s.magnitudeSquared(n),c=Math.sqrt(i),a=s.divideByScalar(n,c,rt);i=Math.max(1,i),c=Math.max(1,c);let r=s.dot(a,e),m=s.magnitude(s.cross(a,e,a)),h=1/c,u=Math.sqrt(i-1)*h;return 1/(r*h-m*u)}function X(o,t,e){if(!(t<=0||t===1/0||t!==t))return s.multiplyByScalar(o,t,e)}var F=new s;function Y(o,t){return s.equals(t,s.ZERO)?t:(o.transformPositionToScaledSpace(t,F),s.normalize(F,F))}var Pt=N;var V={};V.getHeight=function(o,t,e){if(!Number.isFinite(t))throw new R("scale must be a finite number.");if(!Number.isFinite(e))throw new R("relativeHeight must be a finite number.");return(o-e)*t+e};var mt=new s;V.getPosition=function(o,t,e,n,i){let c=t.cartesianToCartographic(o,mt);if(!l(c))return s.clone(o,i);let a=V.getHeight(c.height,e,n);return s.fromRadians(c.longitude,c.latitude,a,t,i)};var $=V;var dt={NONE:0,BITS12:1},S=Object.freeze(dt);var _=new s,lt=new s,f=new x,G=new d,ht=new d,pt=Math.pow(2,12);function p(o,t,e,n,i,c,a,r,m,h,u){let T=S.NONE,g,z;if(l(t)&&l(e)&&l(n)&&l(i)){let C=t.minimum,A=t.maximum,w=s.subtract(A,C,lt),tt=n-e;Math.max(s.maximumComponent(w),tt)<pt-1?T=S.BITS12:T=S.NONE,u&&(T=S.NONE),g=d.inverseTransformation(i,new d);let ot=s.negate(C,_);d.multiply(d.fromTranslation(ot,G),g,g);let q=_;q.x=1/w.x,q.y=1/w.y,q.z=1/w.z,d.multiply(d.fromScale(q,G),g,g),z=d.clone(i),d.setTranslation(z,s.ZERO,z),i=d.clone(i,new d);let et=d.fromTranslation(C,G),it=d.fromScale(w,ht),W=d.multiply(et,it,G);d.multiply(i,W,i),d.multiply(z,W,z)}this.quantization=T,this.minimumHeight=e,this.maximumHeight=n,this.center=s.clone(o),this.toScaledENU=g,this.fromScaledENU=i,this.matrix=z,this.hasVertexNormals=c,this.hasWebMercatorT=E(a,!1),this.hasGeodeticSurfaceNormals=E(r,!1),this.exaggeration=E(m,1),this.exaggerationRelativeHeight=E(h,0),this.stride=0,this._offsetGeodeticSurfaceNormal=0,this._offsetVertexNormal=0,this._calculateStrideAndOffsets()}p.prototype.encode=function(o,t,e,n,i,c,a,r){let m=n.x,h=n.y;if(this.quantization===S.BITS12){e=d.multiplyByPoint(this.toScaledENU,e,_),e.x=b.clamp(e.x,0,1),e.y=b.clamp(e.y,0,1),e.z=b.clamp(e.z,0,1);let u=this.maximumHeight-this.minimumHeight,T=b.clamp((i-this.minimumHeight)/u,0,1);x.fromElements(e.x,e.y,f);let g=y.compressTextureCoordinates(f);x.fromElements(e.z,T,f);let z=y.compressTextureCoordinates(f);x.fromElements(m,h,f);let C=y.compressTextureCoordinates(f);if(o[t++]=g,o[t++]=z,o[t++]=C,this.hasWebMercatorT){x.fromElements(a,0,f);let A=y.compressTextureCoordinates(f);o[t++]=A}}else s.subtract(e,this.center,_),o[t++]=_.x,o[t++]=_.y,o[t++]=_.z,o[t++]=i,o[t++]=m,o[t++]=h,this.hasWebMercatorT&&(o[t++]=a);return this.hasVertexNormals&&(o[t++]=y.octPackFloat(c)),this.hasGeodeticSurfaceNormals&&(o[t++]=r.x,o[t++]=r.y,o[t++]=r.z),t};var ut=new s,B=new s;p.prototype.addGeodeticSurfaceNormals=function(o,t,e){if(this.hasGeodeticSurfaceNormals)return;let n=this.stride,i=o.length/n;this.hasGeodeticSurfaceNormals=!0,this._calculateStrideAndOffsets();let c=this.stride;for(let a=0;a<i;a++){for(let u=0;u<n;u++){let T=a*n+u,g=a*c+u;t[g]=o[T]}let r=this.decodePosition(t,a,ut),m=e.geodeticSurfaceNormal(r,B),h=a*c+this._offsetGeodeticSurfaceNormal;t[h]=m.x,t[h+1]=m.y,t[h+2]=m.z}};p.prototype.removeGeodeticSurfaceNormals=function(o,t){if(!this.hasGeodeticSurfaceNormals)return;let e=this.stride,n=o.length/e;this.hasGeodeticSurfaceNormals=!1,this._calculateStrideAndOffsets();let i=this.stride;for(let c=0;c<n;c++)for(let a=0;a<i;a++){let r=c*e+a,m=c*i+a;t[m]=o[r]}};p.prototype.decodePosition=function(o,t,e){if(l(e)||(e=new s),t*=this.stride,this.quantization===S.BITS12){let n=y.decompressTextureCoordinates(o[t],f);e.x=n.x,e.y=n.y;let i=y.decompressTextureCoordinates(o[t+1],f);return e.z=i.x,d.multiplyByPoint(this.fromScaledENU,e,e)}return e.x=o[t],e.y=o[t+1],e.z=o[t+2],s.add(e,this.center,e)};p.prototype.getExaggeratedPosition=function(o,t,e){e=this.decodePosition(o,t,e);let n=this.exaggeration,i=this.exaggerationRelativeHeight;if(n!==1&&this.hasGeodeticSurfaceNormals){let a=this.decodeGeodeticSurfaceNormal(o,t,B),r=this.decodeHeight(o,t),m=$.getHeight(r,n,i)-r;e.x+=a.x*m,e.y+=a.y*m,e.z+=a.z*m}return e};p.prototype.decodeTextureCoordinates=function(o,t,e){return l(e)||(e=new x),t*=this.stride,this.quantization===S.BITS12?y.decompressTextureCoordinates(o[t+2],e):x.fromElements(o[t+4],o[t+5],e)};p.prototype.decodeHeight=function(o,t){return t*=this.stride,this.quantization===S.BITS12?y.decompressTextureCoordinates(o[t+1],f).y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight:o[t+3]};p.prototype.decodeWebMercatorT=function(o,t){return t*=this.stride,this.quantization===S.BITS12?y.decompressTextureCoordinates(o[t+3],f).x:o[t+6]};p.prototype.getOctEncodedNormal=function(o,t,e){t=t*this.stride+this._offsetVertexNormal;let n=o[t]/256,i=Math.floor(n),c=(n-i)*256;return x.fromElements(i,c,e)};p.prototype.decodeGeodeticSurfaceNormal=function(o,t,e){return t=t*this.stride+this._offsetGeodeticSurfaceNormal,e.x=o[t],e.y=o[t+1],e.z=o[t+2],e};p.prototype._calculateStrideAndOffsets=function(){let o=0;switch(this.quantization){case S.BITS12:o+=3;break;default:o+=6}this.hasWebMercatorT&&(o+=1),this.hasVertexNormals&&(this._offsetVertexNormal=o,o+=1),this.hasGeodeticSurfaceNormals&&(this._offsetGeodeticSurfaceNormal=o,o+=3),this.stride=o};var H={position3DAndHeight:0,textureCoordAndEncodedNormals:1,geodeticSurfaceNormal:2},I={compressed0:0,compressed1:1,geodeticSurfaceNormal:2};p.prototype.getAttributes=function(o){let t=D.FLOAT,e=D.getSizeInBytes(t),n=this.stride*e,i=0,c=[];function a(r,m){c.push({index:r,vertexBuffer:o,componentDatatype:t,componentsPerAttribute:m,offsetInBytes:i,strideInBytes:n}),i+=m*e}if(this.quantization===S.NONE){a(H.position3DAndHeight,4);let r=2;r+=this.hasWebMercatorT?1:0,r+=this.hasVertexNormals?1:0,a(H.textureCoordAndEncodedNormals,r),this.hasGeodeticSurfaceNormals&&a(H.geodeticSurfaceNormal,3)}else{let r=this.hasWebMercatorT||this.hasVertexNormals,m=this.hasWebMercatorT&&this.hasVertexNormals;a(I.compressed0,r?4:3),m&&a(I.compressed1,1),this.hasGeodeticSurfaceNormals&&a(I.geodeticSurfaceNormal,3)}return c};p.prototype.getAttributeLocations=function(){return this.quantization===S.NONE?H:I};p.clone=function(o,t){if(l(o))return l(t)||(t=new p),t.quantization=o.quantization,t.minimumHeight=o.minimumHeight,t.maximumHeight=o.maximumHeight,t.center=s.clone(o.center),t.toScaledENU=d.clone(o.toScaledENU),t.fromScaledENU=d.clone(o.fromScaledENU),t.matrix=d.clone(o.matrix),t.hasVertexNormals=o.hasVertexNormals,t.hasWebMercatorT=o.hasWebMercatorT,t.hasGeodeticSurfaceNormals=o.hasGeodeticSurfaceNormals,t.exaggeration=o.exaggeration,t.exaggerationRelativeHeight=o.exaggerationRelativeHeight,t._calculateStrideAndOffsets(),t};var kt=p;export{Pt as a,kt as b};
