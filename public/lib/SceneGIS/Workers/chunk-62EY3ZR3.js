/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.114
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */

import{a as G}from"./chunk-KGSL5AZH.js";import{a as ut}from"./chunk-3IQGTAU5.js";import{a as tt,b as H}from"./chunk-O6RW7G7V.js";import{a as F}from"./chunk-GLM7D42Y.js";import{a as Q}from"./chunk-755YNYN4.js";import{b as ct}from"./chunk-MYA6XSQU.js";import{a as rt}from"./chunk-EJ4R6WJQ.js";import{a as st}from"./chunk-Y3QWB4WF.js";import{a as it}from"./chunk-KJJSAVM5.js";import{b as Z,c as V,d as W}from"./chunk-5JJAXZP5.js";import{f as $}from"./chunk-XIY2HUS2.js";import{a as k}from"./chunk-PF7ABWYW.js";import{a as x,b as z,c as D,d as ot,e as j}from"./chunk-KXWBEOUA.js";import{a as A}from"./chunk-4BEFMW7D.js";import{a as Y}from"./chunk-2F4MHS2T.js";import{e as y}from"./chunk-A5XXOFX2.js";function gt(o,i){this.positions=y(o)?o:[],this.holes=y(i)?i:[]}var at=gt;function N(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(N.prototype,{length:{get:function(){return this._length}}});N.prototype.enqueue=function(o){this._array.push(o),this._length++};N.prototype.dequeue=function(){if(this._length===0)return;let o=this._array,i=this._offset,u=o[i];return o[i]=void 0,i++,i>10&&i*2>o.length&&(this._array=o.slice(i),i=0),this._offset=i,this._length--,u};N.prototype.peek=function(){if(this._length!==0)return this._array[this._offset]};N.prototype.contains=function(o){return this._array.indexOf(o)!==-1};N.prototype.clear=function(){this._array.length=this._offset=this._length=0};N.prototype.sort=function(o){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(o)};var et=N;var w={};w.computeHierarchyPackedLength=function(o,i){let u=0,c=[o];for(;c.length>0;){let r=c.pop();if(!y(r))continue;u+=2;let l=r.positions,e=r.holes;if(y(l)&&l.length>0&&(u+=l.length*i.packedLength),y(e)){let t=e.length;for(let n=0;n<t;++n)c.push(e[n])}}return u};w.packPolygonHierarchy=function(o,i,u,c){let r=[o];for(;r.length>0;){let l=r.pop();if(!y(l))continue;let e=l.positions,t=l.holes;if(i[u++]=y(e)?e.length:0,i[u++]=y(t)?t.length:0,y(e)){let n=e.length;for(let s=0;s<n;++s,u+=c.packedLength)c.pack(e[s],i,u)}if(y(t)){let n=t.length;for(let s=0;s<n;++s)r.push(t[s])}}return u};w.unpackPolygonHierarchy=function(o,i,u){let c=o[i++],r=o[i++],l=new Array(c),e=r>0?new Array(r):void 0;for(let t=0;t<c;++t,i+=u.packedLength)l[t]=u.unpack(o,i);for(let t=0;t<r;++t)e[t]=w.unpackPolygonHierarchy(o,i,u),i=e[t].startingIndex,delete e[t].startingIndex;return{positions:l,holes:e,startingIndex:i}};var B=new D;function ft(o,i,u,c){return D.subtract(i,o,B),D.multiplyByScalar(B,u/c,B),D.add(o,B,B),[B.x,B.y]}var O=new x;function mt(o,i,u,c){return x.subtract(i,o,O),x.multiplyByScalar(O,u/c,O),x.add(o,O,O),[O.x,O.y,O.z]}w.subdivideLineCount=function(o,i,u){let r=x.distance(o,i)/u,l=Math.max(0,Math.ceil(A.log2(r)));return Math.pow(2,l)};var J=new z,X=new z,pt=new z,yt=new x,K=new Q;w.subdivideRhumbLineCount=function(o,i,u,c){let r=o.cartesianToCartographic(i,J),l=o.cartesianToCartographic(u,X),t=new Q(r,l,o).surfaceDistance/c,n=Math.max(0,Math.ceil(A.log2(t)));return Math.pow(2,n)};w.subdivideTexcoordLine=function(o,i,u,c,r,l){let e=w.subdivideLineCount(u,c,r),t=D.distance(o,i),n=t/e,s=l;s.length=e*2;let a=0;for(let p=0;p<e;p++){let h=ft(o,i,p*n,t);s[a++]=h[0],s[a++]=h[1]}return s};w.subdivideLine=function(o,i,u,c){let r=w.subdivideLineCount(o,i,u),l=x.distance(o,i),e=l/r;y(c)||(c=[]);let t=c;t.length=r*3;let n=0;for(let s=0;s<r;s++){let a=mt(o,i,s*e,l);t[n++]=a[0],t[n++]=a[1],t[n++]=a[2]}return t};w.subdivideTexcoordRhumbLine=function(o,i,u,c,r,l,e){let t=u.cartesianToCartographic(c,J),n=u.cartesianToCartographic(r,X);K.setEndPoints(t,n);let s=K.surfaceDistance/l,a=Math.max(0,Math.ceil(A.log2(s))),p=Math.pow(2,a),h=D.distance(o,i),d=h/p,g=e;g.length=p*2;let m=0;for(let f=0;f<p;f++){let b=ft(o,i,f*d,h);g[m++]=b[0],g[m++]=b[1]}return g};w.subdivideRhumbLine=function(o,i,u,c,r){let l=o.cartesianToCartographic(i,J),e=o.cartesianToCartographic(u,X),t=new Q(l,e,o),n=t.surfaceDistance/c,s=Math.max(0,Math.ceil(A.log2(n))),a=Math.pow(2,s),p=t.surfaceDistance/a;y(r)||(r=[]);let h=r;h.length=a*3;let d=0;for(let g=0;g<a;g++){let m=t.interpolateUsingSurfaceDistance(g*p,pt),f=o.cartographicToCartesian(m,yt);h[d++]=f.x,h[d++]=f.y,h[d++]=f.z}return h};var xt=new x,bt=new x,Lt=new x,wt=new x;w.scaleToGeodeticHeightExtruded=function(o,i,u,c,r,l){c=Y(c,ot.WGS84);let e=xt,t=bt,n=Lt,s=wt;if(y(o)&&y(o.attributes)&&y(o.attributes.position)){let a=o.attributes.position.values,p=a.length/2;for(let h=0;h<p;h+=3)x.fromArray(a,h,n),y(l)&&l===!0?(new x(0,0,1).clone(e),n.clone(s),s.z=0,t=x.multiplyByScalar(e,u,t),t=x.add(s,t,t)):(c.geodeticSurfaceNormal(n,e),s=c.scaleToGeodeticSurface(n,s),t=x.multiplyByScalar(e,u,t),t=x.add(s,t,t)),a[h+p]=t.x,a[h+1+p]=t.y,a[h+2+p]=t.z,r&&(s=x.clone(n,s)),t=x.multiplyByScalar(e,i,t),y(l)&&l===!0?t=x.add(n,t,t):t=x.add(s,t,t),a[h]=t.x,a[h+1]=t.y,a[h+2]=t.z}return o};w.polygonOutlinesFromHierarchy=function(o,i,u,c){c=Y(c,!1);let r=[],l=new et;l.enqueue(o);let e,t,n;for(;l.length!==0;){let s=l.dequeue(),a=s.positions;if(i)for(n=a.length,e=0;e<n;e++)c===!1?u.scaleToGeodeticSurface(a[e],a[e]):a[e].z=0;if(a=F(a,x.equalsEpsilon,!0),a.length<3)continue;let p=s.holes?s.holes.length:0;for(e=0;e<p;e++){let h=s.holes[e],d=h.positions;if(i)for(n=d.length,t=0;t<n;++t)c===!1?u.scaleToGeodeticSurface(d[t],d[t]):d[t].z=0;if(d=F(d,x.equalsEpsilon,!0),d.length<3)continue;r.push(d);let g=0;for(y(h.holes)&&(g=h.holes.length),t=0;t<g;t++)l.enqueue(h.holes[t])}r.push(a)}return r};var Tt=new z;function Et(o,i,u){let c=u.cartesianToCartographic(o,J),r=u.cartesianToCartographic(i,X);if(Math.sign(c.latitude)===Math.sign(r.latitude))return;K.setEndPoints(c,r);let l=K.findIntersectionWithLatitude(0,Tt);if(!y(l))return;let e=Math.min(c.longitude,r.longitude),t=Math.max(c.longitude,r.longitude);if(Math.abs(t-e)>A.PI){let n=e;e=t,t=n}if(!(l.longitude<e||l.longitude>t))return u.cartographicToCartesian(l)}function Ct(o,i,u,c){if(c===G.RHUMB)return Et(o,i,u);let r=ct.lineSegmentPlane(o,i,rt.ORIGIN_XY_PLANE);if(y(r))return u.scaleToGeodeticSurface(r,r)}var vt=new z;function Pt(o,i,u){let c=[],r,l,e,t,n,s=0;for(;s<o.length;){r=o[s],l=o[(s+1)%o.length],e=A.sign(r.z),t=A.sign(l.z);let a=p=>i.cartesianToCartographic(p,vt).longitude;if(e===0)c.push({position:s,type:e,visited:!1,next:t,theta:a(r)});else if(t!==0){if(n=Ct(r,l,i,u),++s,!y(n))continue;o.splice(s,0,n),c.push({position:s,type:e,visited:!1,next:t,theta:a(n)})}++s}return c}function dt(o,i,u,c,r,l,e){let t=[],n=l,s=p=>h=>h.position===p,a=[];do{let p=u[n];t.push(p);let h=c.findIndex(s(n)),d=c[h];if(!y(d)){++n;continue}let{visited:g,type:m,next:f}=d;if(d.visited=!0,m===0){if(f===0){let I=c[h-(e?1:-1)];if(I?.position===n+1)I.visited=!0;else{++n;continue}}if(!g&&e&&f>0||l===n&&!e&&f<0){++n;continue}}if(!(e?m>=0:m<=0)){++n;continue}g||a.push(n);let T=h+(e?1:-1),S=c[T];if(!y(S)){++n;continue}n=S.position}while(n<u.length&&n>=0&&n!==l&&t.length<u.length);o.splice(i,r,t);for(let p of a)i=dt(o,++i,u,c,0,p,!e);return i}w.splitPolygonsOnEquator=function(o,i,u,c){y(c)||(c=[]),c.splice(0,0,...o),c.length=o.length;let r=0;for(;r<c.length;){let l=c[r],e=l.slice();if(l.length<3){c[r]=e,++r;continue}let t=Pt(e,i,u);if(e.length===l.length||t.length<=1){c[r]=e,++r;continue}t.sort((s,a)=>s.theta-a.theta);let n=e[0].z>=0;r=dt(c,r,e,t,1,0,n)}return c};w.polygonsFromHierarchy=function(o,i,u,c,r,l,e){e=Y(e,!1);let t=[],n=[],s=new et;s.enqueue(o);let a=y(l);for(;s.length!==0;){let p=s.dequeue(),h=p.positions,d=p.holes,g,m;if(c)for(m=h.length,g=0;g<m;g++)!y(e)||e===!1?r.scaleToGeodeticSurface(h[g],h[g]):h[g].z=0;if(i||(h=F(h,x.equalsEpsilon,!0)),h.length<3)continue;let f=[];if(e===!0)for(let P of h){let L=D.fromCartesian3(P);f.push(L)}else f=u(h);if(!y(f))continue;let b=[],T=H.computeWindingOrder2D(f);if(T===tt.CLOCKWISE&&(f.reverse(),h=h.slice().reverse()),a){a=!1;let P=[h];if(P=l(P,P),P.length>1){for(let L of P)s.enqueue(new at(L,d));continue}}let S=h.slice(),I=y(d)?d.length:0,R=[],v;for(g=0;g<I;g++){let P=d[g],L=P.positions;if(c)for(m=L.length,v=0;v<m;++v)!y(e)||e===!1?r.scaleToGeodeticSurface(L[v],L[v]):L[v].z=0;if(i||(L=F(L,x.equalsEpsilon,!0)),L.length<3)continue;let C=[];if(e===!0){let E=new D;for(let q of h)E.x+=q.x,E.y+=q.y;E.x=E.x/h.length,E.y=E.y/h.length;for(let q of L){let M=D.fromCartesian3(q);M.x-=E.x,M.y-=E.y,C.push(M)}}else C=u(L);if(!y(C))continue;T=H.computeWindingOrder2D(C),T===tt.CLOCKWISE&&(C.reverse(),L=L.slice().reverse()),R.push(L),b.push(S.length),S=S.concat(L),f=f.concat(C);let _=0;for(y(P.holes)&&(_=P.holes.length),v=0;v<_;v++)s.enqueue(P.holes[v])}t.push({outerRing:h,holes:R}),n.push({positions:S,positions2D:f,holes:b})}return{hierarchy:t,polygons:n}};var nt=new D,Dt=new x,St=new $,It=new j;w.computeBoundingRectangle=function(o,i,u,c,r,l){let e=$.fromAxisAngle(o,c,St),t=j.fromQuaternion(e,It),n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,h=u.length;for(let d=0;d<h;++d){let g=x.clone(u[d],Dt);j.multiplyByVector(t,g,g);let m=nt;l===!0?m=D.fromCartesian3(g,nt):m=i(g,nt),y(m)&&(n=Math.min(n,m.x),s=Math.max(s,m.x),a=Math.min(a,m.y),p=Math.max(p,m.y))}return r.x=n,r.y=a,r.width=s-n,r.height=p-a,r};w.createGeometryFromPositions=function(o,i,u,c,r,l,e,t){let n=H.triangulate(i.positions2D,i.holes);n.length<3&&(n=[0,1,2]);let s=i.positions,a=y(u),p=a?u.positions:void 0;if(r){let h=s.length,d=new Array(h*3),g=0;for(let b=0;b<h;b++){let T=s[b];d[g++]=T.x,d[g++]=T.y,d[g++]=T.z}let m={attributes:{position:new W({componentDatatype:k.DOUBLE,componentsPerAttribute:3,values:d})},indices:n,primitiveType:Z.TRIANGLES};a&&(m.attributes.st=new W({componentDatatype:k.FLOAT,componentsPerAttribute:2,values:D.packArray(p)}));let f=new V(m);return l.normal?ut.computeNormal(f):f}if(e===G.GEODESIC)return H.computeSubdivision(o,s,n,p,c,t);if(e===G.RHUMB)return H.computeRhumbLineSubdivision(o,s,n,p,c)};var ht=[],lt=[],_t=new x,At=new x;w.computeWallGeometry=function(o,i,u,c,r,l){let e,t,n,s,a,p,h,d,g,m=o.length,f=0,b=0,T=y(i),S=T?i.positions:void 0;if(r)for(t=m*3*2,e=new Array(t*2),T&&(g=m*2*2,d=new Array(g*2)),n=0;n<m;n++)s=o[n],a=o[(n+1)%m],e[f]=e[f+t]=s.x,++f,e[f]=e[f+t]=s.y,++f,e[f]=e[f+t]=s.z,++f,e[f]=e[f+t]=a.x,++f,e[f]=e[f+t]=a.y,++f,e[f]=e[f+t]=a.z,++f,T&&(p=S[n],h=S[(n+1)%m],d[b]=d[b+g]=p.x,++b,d[b]=d[b+g]=p.y,++b,d[b]=d[b+g]=h.x,++b,d[b]=d[b+g]=h.y,++b);else{let L=A.chordLength(c,u.maximumRadius),C=0;if(l===G.GEODESIC)for(n=0;n<m;n++)C+=w.subdivideLineCount(o[n],o[(n+1)%m],L);else if(l===G.RHUMB)for(n=0;n<m;n++)C+=w.subdivideRhumbLineCount(u,o[n],o[(n+1)%m],L);for(t=(C+m)*3,e=new Array(t*2),T&&(g=(C+m)*2,d=new Array(g*2)),n=0;n<m;n++){s=o[n],a=o[(n+1)%m];let _,E;T&&(p=S[n],h=S[(n+1)%m]),l===G.GEODESIC?(_=w.subdivideLine(s,a,L,lt),T&&(E=w.subdivideTexcoordLine(p,h,s,a,L,ht))):l===G.RHUMB&&(_=w.subdivideRhumbLine(u,s,a,L,lt),T&&(E=w.subdivideTexcoordRhumbLine(p,h,u,s,a,L,ht)));let q=_.length;for(let M=0;M<q;++M,++f)e[f]=_[M],e[f+t]=_[M];if(e[f]=a.x,e[f+t]=a.x,++f,e[f]=a.y,e[f+t]=a.y,++f,e[f]=a.z,e[f+t]=a.z,++f,T){let M=E.length;for(let U=0;U<M;++U,++b)d[b]=E[U],d[b+g]=E[U];d[b]=h.x,d[b+g]=h.x,++b,d[b]=h.y,d[b+g]=h.y,++b}}}m=e.length;let I=st.createTypedArray(m/3,m-o.length*6),R=0;for(m/=6,n=0;n<m;n++){let L=n,C=L+1,_=L+m,E=_+1;s=x.fromArray(e,L*3,_t),a=x.fromArray(e,C*3,At),!x.equalsEpsilon(s,a,A.EPSILON10,A.EPSILON10)&&(I[R++]=L,I[R++]=_,I[R++]=C,I[R++]=C,I[R++]=_,I[R++]=E)}let v={attributes:new it({position:new W({componentDatatype:k.DOUBLE,componentsPerAttribute:3,values:e})}),indices:I,primitiveType:Z.TRIANGLES};return T&&(v.attributes.st=new W({componentDatatype:k.FLOAT,componentsPerAttribute:2,values:d})),new V(v)};var ce=w;export{ce as a};
